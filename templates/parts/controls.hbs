<div class="tavern-controls">
  {{!-- Lobby state --}}
  {{#if isLobby}}
    <div class="control-section">
      <h3><i class="fa-solid fa-users"></i> Join the Game</h3>
      {{#if canJoin}}
        <button type="button" class="btn btn-primary btn-large" data-action="join">
          <i class="fa-solid fa-chair"></i> Take a Seat
        </button>
      {{else if isInGame}}
        <button type="button" class="btn btn-secondary" data-action="leave">
          <i class="fa-solid fa-door-open"></i> Leave Table
        </button>
      {{/if}}
    </div>

    {{#if isGM}}
      <div class="control-section">
        <h3><i class="fa-solid fa-play"></i> Start Game</h3>
        {{#if hasPlayers}}
          <button type="button" class="btn btn-success btn-large" data-action="start">
            <i class="fa-solid fa-dice"></i> Deal the Dice!
          </button>
          <p class="hint">{{players.length}} player{{#if (gt players.length 1)}}s{{/if}} at the table</p>
        {{else}}
          <p class="hint">Waiting for players to join...</p>
        {{/if}}
      </div>
    {{/if}}

    <div class="control-section rules">
      <h3><i class="fa-solid fa-scroll"></i> Rules</h3>
      <ul>
        <li>Opening: everyone rolls <strong>2 dice</strong></li>
        <li>Then take turns: roll (costs {{ante}}gp) or hold</li>
        <li>Try to reach <strong>21</strong> without busting</li>
        <li>Highest total â‰¤21 wins the pot!</li>
      </ul>
    </div>
  {{/if}}

  {{!-- Playing state --}}
  {{#if isPlaying}}
    {{#if myTurn}}
      <div class="control-section your-turn">
        <h3><i class="fa-solid fa-dice"></i> Your Turn!</h3>
        
        {{#if isOpeningPhase}}
          <p class="turn-hint phase-opening">
            <strong>Opening Round:</strong> Roll {{openingRollsRemaining}} more {{#if (eq openingRollsRemaining 1)}}die{{else}}dice{{/if}}.
          </p>
        {{else}}
          <p class="turn-hint phase-betting">
            <strong>Betting Round:</strong> Roll ({{ante}}gp) or hold.
          </p>
        {{/if}}
        
        <div class="dice-buttons premium">
          {{#each dice}}
            <button type="button" class="btn-die-premium" data-action="roll" data-die="{{this.value}}" title="Roll {{this.label}}">
              <img src="icons/svg/{{this.icon}}.svg" alt="{{this.label}}" class="die-icon" />
              <span class="die-label">{{this.label}}</span>
            </button>
          {{/each}}
        </div>

        {{#if isBettingPhase}}
          <button type="button" class="btn btn-hold" data-action="hold">
            <i class="fa-solid fa-hand"></i> Hold
          </button>
        {{/if}}
      </div>
    {{else}}
      <div class="control-section waiting">
        <h3><i class="fa-solid fa-hourglass-half"></i> Waiting</h3>
        {{#if currentPlayer}}
          <p class="waiting-text">
            <strong>{{currentPlayer.name}}</strong> is rolling...
          </p>
        {{/if}}
        {{#if isOpeningPhase}}
          <p class="phase-label">Opening Round</p>
        {{else}}
          <p class="phase-label">Betting Round</p>
        {{/if}}
      </div>
    {{/if}}

    {{!-- Cheat button - available when you have dice --}}
    {{#if canCheat}}
      <div class="control-section cheat-section">
        <button type="button" class="btn btn-cheat" data-action="cheat">
          <i class="fa-solid fa-mask"></i> Cheat
        </button>
        <p class="hint cheat-hint">Sleight of hand... Choose Deception or Sleight of Hand.</p>
      </div>
    {{/if}}

    {{#if isGM}}
      <div class="control-section gm-controls">
        <button type="button" class="btn btn-secondary btn-small" data-action="reveal">
          <i class="fa-solid fa-eye"></i> Force Reveal
        </button>
      </div>
    {{/if}}
  {{/if}}

  {{!-- Staredown / Accusation state --}}
  {{#if isInspection}}
    <div class="control-section staredown">
      <h3><i class="fa-solid fa-eye"></i> The Staredown</h3>
      
      {{#if accusationMade}}
        <p class="staredown-text">An accusation has been made. The tension builds...</p>
        <p class="staredown-hint"><i class="fa-solid fa-hourglass-half"></i> Awaiting the GM to reveal the truth.</p>
      {{else}}
        <p class="staredown-text">All hands are in. Who do you trust?</p>
        <p class="staredown-warning"><i class="fa-solid fa-warning"></i> Accuse an innocent and you forfeit your winnings!</p>
        
        {{#if isInGame}}
          {{#if canAccuse}}
            <div class="accuse-section">
              <label>Who do you suspect?</label>
              <div class="accuse-portraits">
                {{#each accuseTargets}}
                  <div class="accuse-portrait" data-target-id="{{this.id}}" data-target-name="{{this.name}}" tabindex="0">
                    <img src="{{this.img}}" alt="{{this.name}}" />
                    <span class="portrait-name">{{this.name}}</span>
                  </div>
                {{/each}}
              </div>
              <button type="button" class="btn btn-accuse" data-action="accuse" disabled>
                <i class="fa-solid fa-hand-point-right"></i> Accuse ({{accusationCost}}gp)
              </button>
            </div>
            <p class="hint">Click a portrait to select. Cost: Half the pot.</p>
          {{/if}}
        {{/if}}
      {{/if}}
      
      {{#if isGM}}
        <button type="button" class="btn btn-success" data-action="skipInspection">
          <i class="fa-solid fa-eye"></i> Reveal Results
        </button>
      {{/if}}
    </div>
  {{/if}}

  {{!-- Revealing state --}}
  {{#if isRevealing}}
    <div class="control-section revealing">
      <h3><i class="fa-solid fa-eye"></i> Revealing...</h3>
      <p>All dice are being revealed!</p>
      <div class="reveal-animation">
        <i class="fa-solid fa-dice fa-spin"></i>
      </div>
    </div>
  {{/if}}

  {{!-- Payout state --}}
  {{#if isPayout}}
    <div class="control-section payout">
      <h3><i class="fa-solid fa-trophy"></i> Round Complete!</h3>
      {{#if isInGame}}
        <button type="button" class="btn btn-secondary" data-action="leave">
          <i class="fa-solid fa-door-open"></i> Leave Table
        </button>
      {{/if}}
      {{#if isGM}}
        <button type="button" class="btn btn-success btn-large" data-action="newRound">
          <i class="fa-solid fa-rotate"></i> New Round
        </button>
      {{/if}}
    </div>
  {{/if}}
</div>
