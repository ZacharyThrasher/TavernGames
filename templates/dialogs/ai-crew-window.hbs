<div class="tavern-dialog ai-crew-dialog">
  {{#if isGM}}
  <div class="ai-crew-toolbar">
    <div class="ai-crew-summary">
      <span><strong>Status:</strong> {{status}}</span>
      <span><strong>AI Seats:</strong> {{aiSeatCount}}</span>
      <span><strong>Autoplay Active:</strong> {{autoplayEnabledCount}}</span>
    </div>
    {{#unless canManageAiSeats}}
    <p class="hint">Add/remove AI seats is available in Lobby or Payout.</p>
    {{/unless}}
  </div>

  <section class="ai-crew-card">
    <h3><i class="fa-solid fa-user-plus"></i> Add AI NPC</h3>
    <div class="ai-crew-grid">
      <label class="ai-crew-field">
        <span>NPC Search</span>
        <input type="text" class="ai-crew-npc-search" placeholder="Type to filter NPCs">
      </label>

      <label class="ai-crew-field">
        <span>NPC</span>
        <select class="ai-crew-actor-select" {{#unless hasNpcActorOptions}}disabled{{/unless}}>
          <option value="">Random NPC</option>
          {{#each npcActorOptions}}
          <option value="{{this.id}}">{{this.name}}</option>
          {{/each}}
        </select>
      </label>

      <label class="ai-crew-field">
        <span>Name Override</span>
        <input type="text" class="ai-crew-name-input" maxlength="40" placeholder="Optional custom name">
      </label>

      <label class="ai-crew-field">
        <span>Playstyle</span>
        <select class="ai-crew-default-strategy">
          <option value="balanced">Balanced</option>
          <option value="aggressive">Aggressive</option>
          <option value="conservative">Conservative</option>
          <option value="duelist">Duelist</option>
          <option value="tactician">Tactician</option>
          <option value="bully">Bully</option>
          <option value="chaotic">Chaotic</option>
        </select>
      </label>

      <label class="ai-crew-field">
        <span>Difficulty</span>
        <select class="ai-crew-default-difficulty">
          <option value="easy">Easy</option>
          <option value="normal" selected>Normal</option>
          <option value="hard">Hard</option>
          <option value="legendary">Legendary</option>
        </select>
      </label>

      <label class="ai-crew-field">
        <span>Wallet</span>
        <input type="number" class="ai-crew-wallet-input" min="{{ante}}" step="{{ante}}" value="{{defaultAiWallet}}">
      </label>
    </div>
    <div class="ai-crew-actions">
      <button type="button" class="btn btn-secondary btn-small btn-ai-crew-add" {{#unless canManageAiSeats}}disabled{{/unless}}>
        <i class="fa-solid fa-user-plus"></i> Add AI Seat
      </button>
    </div>
  </section>

  <section class="ai-crew-card">
    <h3><i class="fa-solid fa-dragon"></i> Summon AI Party</h3>
    <div class="ai-crew-grid ai-crew-party-grid">
      <label class="ai-crew-field">
        <span>Party Size</span>
        <input type="number" class="ai-crew-party-count" min="1" max="8" value="3">
      </label>

      <label class="ai-crew-field">
        <span>Party Style</span>
        <select class="ai-crew-party-style">
          <option value="mixed" selected>Mixed</option>
          <option value="fixed">Use Selected Playstyle</option>
        </select>
      </label>
    </div>
    <div class="ai-crew-actions">
      <button type="button" class="btn btn-secondary btn-small btn-ai-crew-summon" {{#unless canManageAiSeats}}disabled{{/unless}}>
        <i class="fa-solid fa-dragon"></i> Summon AI Party
      </button>
    </div>
  </section>

  <section class="ai-crew-card">
    <h3><i class="fa-solid fa-sliders"></i> Seat Behavior</h3>
    {{#if hasRows}}
    <div class="ai-crew-seat-list">
      {{#each autoplayRows}}
      <div class="ai-crew-seat-row {{#if this.isAi}}is-ai{{/if}}">
        <div class="ai-crew-seat-name">
          <span>{{this.name}}</span>
          {{#if this.isAi}}
          <small>AI</small>
          {{else}}
          <small>Player</small>
          {{/if}}
        </div>

        <label class="ai-crew-toggle-label">
          <input type="checkbox" class="ai-crew-autoplay-toggle" data-player-id="{{this.id}}" {{#if this.enabled}}checked{{/if}}>
          <span>Autoplay</span>
        </label>

        <select class="ai-crew-strategy" data-player-id="{{this.id}}" {{#unless this.enabled}}disabled{{/unless}}>
          <option value="balanced" {{#if (eq this.strategy "balanced")}}selected{{/if}}>Balanced</option>
          <option value="aggressive" {{#if (eq this.strategy "aggressive")}}selected{{/if}}>Aggressive</option>
          <option value="conservative" {{#if (eq this.strategy "conservative")}}selected{{/if}}>Conservative</option>
          <option value="duelist" {{#if (eq this.strategy "duelist")}}selected{{/if}}>Duelist</option>
          <option value="tactician" {{#if (eq this.strategy "tactician")}}selected{{/if}}>Tactician</option>
          <option value="bully" {{#if (eq this.strategy "bully")}}selected{{/if}}>Bully</option>
          <option value="chaotic" {{#if (eq this.strategy "chaotic")}}selected{{/if}}>Chaotic</option>
        </select>

        <select class="ai-crew-difficulty" data-player-id="{{this.id}}" {{#unless this.enabled}}disabled{{/unless}}>
          <option value="easy" {{#if (eq this.difficulty "easy")}}selected{{/if}}>Easy</option>
          <option value="normal" {{#if (eq this.difficulty "normal")}}selected{{/if}}>Normal</option>
          <option value="hard" {{#if (eq this.difficulty "hard")}}selected{{/if}}>Hard</option>
          <option value="legendary" {{#if (eq this.difficulty "legendary")}}selected{{/if}}>Legendary</option>
        </select>

        {{#if this.isAi}}
        <button type="button" class="btn btn-secondary btn-small btn-ai-crew-remove" data-player-id="{{this.id}}" {{#unless this.canRemove}}disabled{{/unless}}>
          <i class="fa-solid fa-user-xmark"></i>
        </button>
        {{else}}
        <span class="ai-crew-seat-pill">Player Seat</span>
        {{/if}}
      </div>
      {{/each}}
    </div>
    {{else}}
    <p class="hint">No seats are currently assigned.</p>
    {{/if}}
  </section>
  {{else}}
  <p class="hint">Only the GM can access AI Crew controls.</p>
  {{/if}}
</div>

